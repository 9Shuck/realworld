<div class="article-meta">
	<a rel='prefetch' href='/user/{{encodeURIComponent(article.author.username)}}'>
		<img src={{article.author.image}} alt={{article.author.username}} />
	</a>

	<div class="info">
		<a rel='prefetch' href='/user/{{encodeURIComponent(article.author.username)}}' class="author"> {{article.author.username}}</a>
		<span class="date">
			{{new Date(article.createdAt).toDateString()}}
		</span>
	</div>

	{{#if canModify}}
		<span>
			<a rel='prefetch' href='/editor/{{article.slug}}' class="btn btn-outline-secondary btn-sm">
				<i class="ion-edit"/> Edit Article
			</a>

			<button class="btn btn-outline-danger btn-sm" on:click='remove()'>
				<i class="ion-trash-a"/> Delete Article
			</button>
		</span>
	{{/if}}
</div>

<script>
	import { goto } from 'sapper/runtime.js';
	import * as api from '../_api.js';

	export default {
		computed: {
			canModify: (article, user) => user && article.author.username === user.username
		},

		methods: {
			remove() {
				const { user, article } = this.get();

				api.del(`/articles/${article.slug}`, user && user.token).then(response => {
					goto('/');
				});
			}
		}
	};
</script>